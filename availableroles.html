<!doctype html>
<html lang="en">

<head>
    <title>Available Roles</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css'
        rel='stylesheet'
        integrity='sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC'
        crossorigin='anonymous'>
    
        <!-- Vue 3 -->
        <script src='https://cdn.jsdelivr.net/npm/vue@3.0.2/dist/vue.global.js'></script>
        <!-- Vue 3: production version, optimized for size and speed -->
        <!-- <script src='https://cdn.jsdelivr.net/npm/vue@3.0.2/dist/vue.global.prod.js'></script> -->
    
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        
<style>
    .card {
        display:inline-block !important;
        margin-left:20px;
        margin-right:20px;
        margin-top:20px;
        margin-bottom:20px;
    }
</style>
<script>
    
    var roles = []
  
    const sendGetRequest = async () => {
    try {
        const resp = await axios.get('http://localhost:5000/roles');
        roles = resp.data.data;
        var roleTable = document.getElementById("roleList");
        
        
        var innerstring = '<div class="card-deck">'
      
        for (role of roles){

            innerstring += `
            
                <div class="card h-100"  style="width: 20rem">
                    <img class="card-img-top" src="..." alt="Card image cap">
                    <div class="card-body">
                    <h5 class="card-title">` + role.RoleName + `</h5>
                    <p class="card-text" id="text`+role.RoleID+`">` + role.Description + `</p>
                    </div>
                    <div class="card-footer">
                    <button onclick="sendSRBRRequest(this.value)" value=`+role.RoleID+` class="btn btn-primary">View Skills</a>
                    </div>
                </div>
                `
        }
        innerstring += "</div>"
       
        roleTable.innerHTML = innerstring
        
    } catch (err) {
        // Handle Error Here
        console.error(err);
    }
};

sendGetRequest();

var skillstext = "";

const sendSRBRRequest = async (roleid) => {
    try {
        const resp2 = await axios.get('http://localhost:5001/getSRBRbyRoleID?RoleID=' + roleid);
        SRBR = resp2.data.data
        var elem = document.getElementById("text" + roleid);
        elem.innerHTML += "</br>";
        elem.innerHTML += "<strong> Skills Required </strong>";
        skillstext = "";
        if(SRBR.length>0){
            skillstext += "<ul>"
            for(sr of SRBR){
                
                skillstext += "<li>"
                skillstext += '<a href="viewcoursebyskill.html?sid=' + sr.SkillsID +'">'   
                var skillname = await getSkill(roleid,sr.SkillsID)
                skillstext += skillname[0].Skillname
             
                skillstext += "</a></li>" 
                console.log(skillstext)    
            }
            skillstext += "</ul>"
            elem.innerHTML += skillstext

        } else {
            elem.innerHTML += "None";
        }
        


        
    } catch (err) {
        // Handle Error Here
        console.error(err);
    }
};


const getSkill = async (roleid,skillid) => {
    try {
        const resp3 = await axios.get('http://localhost:5002/getSkillbyId?skillid=' + skillid);
        
        return resp3.data.data
        


        
    } catch (err) {
        // Handle Error Here
        console.error(err);
    }
};

$(function(){
      $("#includedContent").load("learningjourneypopup.html"); 
    });

</script>

</head>

<body>
    <div id="nav-placeholder"></div>
    <div class="container" id ="roleList"></div>

    <div id="includedContent"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script type="module">
        import navbar from "/navbar.js";
        window.addEventListener('load', () => document.getElementById('nav-placeholder').innerHTML = navbar);
    </script>
</body>
</html>