<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Bootstrap CSS -->
  <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css'
  rel='stylesheet'
  integrity='sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC'
  crossorigin='anonymous'>

  <!-- Vue 3 -->
  <script src='https://cdn.jsdelivr.net/npm/vue@3.0.2/dist/vue.global.js'></script>
  <!-- Vue 3: production version, optimized for size and speed -->
  <!-- <script src='https://cdn.jsdelivr.net/npm/vue@3.0.2/dist/vue.global.prod.js'></script> -->

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <title>Learning Journey</title>
</head>
<body>
  <style></style>
  <div id="nav-placeholder"></div>
  <main id="app">
    <div class="p-3 m-4">
      <button id="addNewLJC" class="btn btn-primary" @click="addNewLJC">Add LJC</button>
    </div>
    <div class="container bg-light m-3" v-for="{ LJCID, CourseID, CourseName, CourseDescription } in learningJourneyCourses" :key="LJCID">
      <!-- <button class="btn bg-success text-white" @click="handleClickLJC(LJCID)">{{ LJCID }}</button> -->
      <div>ID: {{ CourseID }}</div>
      <div>Name: {{ CourseName }}</div>
      <div>Description: {{ CourseDescription }}</div>
    </div>
  </main>
  <script>
    const { createApp, ref, computed, onMounted } = Vue;
    createApp({
      setup() {
        const learningJourneyCourses = ref([]);
        const userId = window.sessionStorage.getItem("user-id");
        if (!userId) window.location.replace(`${window.location.origin}/home.html`); // if user not logged in, redirect to home.html
        const baseURL = "http://127.0.0.1:5105/LJC";
        const options = {
          headers: { "Content-Type": "application/json" },
          mode: "cors",
        };

        const urlParams = new URLSearchParams(window.location.search);
        const LJID = parseInt(urlParams.get("LJID"));

        async function addNewLJC() {
          // try {
          //   const reply = await fetch(`${baseURL}/create`, {
          //     method: "POST",
          //     ...options,
          //     body: JSON.stringify({ LJID: parseInt(LJID), Saved: 1 }),
          //   });
          //   // console.log(await reply.json());
          //   window.location.reload(); // reload after successful creation
          // } catch (err) {
          //   console.log(err);
          //   alert("Failed to create new Learning Journey");
          // }
        }

        function handleClickLJC() {}

        onMounted(async () => {
          const reply = await fetch(`${baseURL}/getAll?LJID=${LJID}`, {
            method: "GET",
            ...options,
          });
          const { data } = await reply.json();
          learningJourneyCourses.value = data;
        });

        return { learningJourneyCourses };
      }
    }).mount("#app");
  </script>
  <script type="module">
    import navbar from "/navbar.js";
    window.addEventListener('load', () => document.getElementById('nav-placeholder').innerHTML = navbar);
  </script>
</body>
</html>