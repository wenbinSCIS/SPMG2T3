<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Role</title>
    <!-- Bootstrap CSS -->
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css'
        rel='stylesheet'
        integrity='sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC'
        crossorigin='anonymous'>

    <!-- Vue 3 -->
    <script src='https://cdn.jsdelivr.net/npm/vue@3.0.2/dist/vue.global.js'></script>
    <!-- Vue 3: production version, optimized for size and speed -->
    <!-- <script src='https://cdn.jsdelivr.net/npm/vue@3.0.2/dist/vue.global.prod.js'></script> -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>

    <script src="https://unpkg.com/@suadelabs/vue3-multiselect@1.0.1/dist/vue3-multiselect.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@suadelabs/vue3-multiselect@1.0.1/dist/vue3-multiselect.css">
    
    <style>
/* Modal styles */
    .modal .modal-dialog {
    	max-width: 400px;
    }
    .modal .modal-header, .modal .modal-body, .modal .modal-footer {
	    padding: 20px 30px;
    }
    .modal .modal-content {
	    border-radius: 3px;
	    font-size: 14px;
    }
    .modal .modal-footer {
	    background: #ecf0f1;
	    border-radius: 0 0 3px 3px;
    }
    .modal .modal-title {
	    display: inline-block;
    }
    .modal .form-control {
	    border-radius: 2px;
    	box-shadow: none;
	    border-color: #dddddd;
    }
    .modal textarea.form-control {
	    resize: vertical;
    }
    .modal .btn {
	    border-radius: 2px;
	    min-width: 100px;
    }	
    .modal form label {
	    font-weight: normal;
    }	

    </style>

</head>
<body>
    <div id="nav-placeholder"></div>
    <input type="button" class="btn btn-success mt-5 ms-5" data-toggle="modal" id="add_role_button" value="Add New Role">

    <div id="add_role_modal" class="modal">
	    <div class="modal-dialog">
		    <div class="modal-content">
			    <form>
				    <div class="modal-header">						
					    <h4 class="modal-title">Add Role</h4>
    					<button type="button" class="close" data-dismiss="modal" aria-hidden="true" id="close_add_role_button">&times;</button>
	    			</div>
		    		<div class="modal-body">				
                        <div class="form-group">
                            <label for="role_name">Role Name</label>
                            <input type="text" v-model="role_name" class="form-control" id="skill_name"  placeholder="Enter role">
                        </div>
            
                        <div class="form-group">
                            <label for="role_description">Description</label>
                            <textarea class="form-control" v-model="description" id="skill_description" placeholder="Description"></textarea>
                        </div>
            
                        <div class="form-group">
                            <label for="skill_required_selection">Skill Required</label>

                            <VueMultiselect id="skill_required_selection"
                            v-model="skill_selected"
                            :options="skill_list"
                            :multiple="true"
                            :close-on-select="false" :clear-on-select="false"
                            placeholder="Select Skills"
                            label="Skillname"
                            track-by="SkillsID"/>
                        </div>
    				</div>
	    			<div class="modal-footer">
		    			<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
			    		<input type="submit" class="btn btn-success" value="Add" v-on:click="create_role">
				    </div>
    			</form>
	    	</div>
	    </div>
    </div>

    <script>
        Vue.createApp({
        data() {
            return {
            skill_list:[],
            role_name:"",
            description:"",
            skill_selected:null,
            role_list:[]
            };
        },
        methods:
        {
            get_all_skill(){
                axios.get('http://127.0.0.1:5002/getAllSkill')
                .then(response => {
                    // this gets the data, which is an array, and pass the data to Vue instance's posts property
                    this.skill_list = response.data.data
                })
                .catch(error => {
                    this.skill_list = [{ entry: 'There was an error: ' + error.message }]
                })
            },

            create_role(){
                axios.get('http://127.0.0.1:5000/roles/getAll')
                            .then(response => {
                                // this gets the data, which is an array, and pass the data to Vue instance's posts property
                                this.role_list = response.data.data
                            })
                            .catch(error => {
                                this.role_list = [{ entry: 'There was an error: ' + error.message }]
                            })

                    cur_role_id = 1+this.role_list.length

                    axios.post('http://127.0.0.1:5000/roles/create', {
                        "Role Name": this.role_name,
                        "Created By": "function test",
                        "Description": this.description,
                        "role_id": cur_role_id
                        })
                        .then(function (response) {
                            console.log(response);
                        })
                        .catch(function (error) {
                            console.log(error);
                        });

                        for (let i=0;i<this.skill_selected;i++){
                            axios.post('http://127.0.0.1:5001/addskillrole', {
                                "RoleID": cur_role_id,
                                "SkillsID": i
                                })
                                .then(function (response) {
                                console.log(response);
                                })
                                .catch(function (error) {
                                    console.log(error);
                                });

                            }

                        
            }
        },
        computed:
        {
            
        },
        created(){
            this.get_all_skill()
        },
        components: { vuemultiselect: window.Vue3Multiselect.default },
    }).mount('#add_role_modal')

    //Modal
    var add_role_modal = document.getElementById("add_role_modal");

    // Get the button that opens the modal
    var add_role_button = document.getElementById("add_role_button");

    // Get the <span> element that closes the modal
    var close_add_role_button = document.getElementById("close_add_role_button");

    // When the user clicks on the button, open the modal
    add_role_button.onclick = function() {
        add_role_modal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modal
    close_add_role_button.onclick = function() {
        add_role_modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == add_role_modal) {
            add_role_modal.style.display = "none";
        }
    }

    
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script type="module">
        import navbar from "/navbar.js";
        window.addEventListener('load', () => document.getElementById('nav-placeholder').innerHTML = navbar);
    </script>
</body>
</html>