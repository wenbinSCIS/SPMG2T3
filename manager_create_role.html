<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Role</title>
    <!-- Bootstrap CSS -->
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css'
        rel='stylesheet'
        integrity='sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC'
        crossorigin='anonymous'>

    <!-- Vue 3 -->
    <script src='https://cdn.jsdelivr.net/npm/vue@3.0.2/dist/vue.global.js'></script>
    <!-- Vue 3: production version, optimized for size and speed -->
    <!-- <script src='https://cdn.jsdelivr.net/npm/vue@3.0.2/dist/vue.global.prod.js'></script> -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="nav-placeholder"></div>

    <div class="container mt-5" id="app">
        <form>
            <div class="form-group">
                <label for="role_name">Role Name</label>
                <input type="text" v-model="role_name" class="form-control" id="skill_name"  placeholder="Enter role">
            </div>

            <div class="form-group">
                <label for="role_description">Description</label>
                <textarea class="form-control" v-model="description" id="skill_description" placeholder="Description"></textarea>
            </div>

            <div class="form-group">
                <label for="skill_required">Skill Required</label>
                <select class="form-select" v-model="skill_selected" aria-label="Default select example" id="skill_required" multiple>
                    <option disabled>Select skill</option>
                    <option v-for="cur_skill in skill_list" value="{{cur_skill.SkillsID}}">{{cur_skill.Skillname}}</option>
                </select>
            </div>
            <button type="button" v-on:click="create_role" class="btn btn-primary mt-4">Submit</button>
        </form>
    </div>
    
    <script>
        Vue.createApp({
        data() {
            return {
            skill_list:[],
            role_name:"",
            description:"",
            skill_selected:""
            };
        },
        methods:
        {
            get_all_skill(){
                axios.get('http://localhost:5002/getAllSkill')
                .then(response => {
                    // this gets the data, which is an array, and pass the data to Vue instance's posts property
                    this.skill_list = response.data
                })
                .catch(error => {
                    this.skill_list = [{ entry: 'There was an error: ' + error.message }]
                })
            },

            create_role(){
                let jsonData = JSON.stringify({
                        RoleName: this.role_name,
                        Description: this.description,
                        CreatedBy: "test",
                        Fulfilled: "",
                    });
                    
                    fetch(`http://localhost:5000/roles/create`,
                        {
                            method: "POST",
                            headers: {
                                "Content-type": "application/json"
                            },
                            body: jsonData
                        })
                        .then(response => response.json())
                        .then(data => {
                            console.log(data);
                            result = data.data;
                            console.log(result);
                            // 3 cases
                            switch (data.code) {
                                case 201:
                                    btn_to_change.setAttribute("class","btn btn-success disabled")
                                    btn_to_change.innerHTML="Booked"

                                    // refresh lesson list

                                    // an alternate way is to add this one element into this.books
                                    break;
                                case 400:
                                default:
                                    throw `${data.code}: ${data.message}`;
                            }
                        })

                        
            }
        },
        computed:
        {
            
        },
        created(){
            this.get_all_skill()
            }
    }).mount('#app')

    role_name=1
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script type="module">
        import navbar from "/navbar.js";
        window.addEventListener('load', () => document.getElementById('nav-placeholder').innerHTML = navbar);
    </script>
</body>
</html>